{
  "openrpc": "1.2.6",
  "info": {
      "title": "cdev Unified API",
      "description": "JSON-RPC 2.0 API for cdev mobile AI coding agent",
      "version": "1.0.0"
  },
  "servers": [
      {
          "name": "Default",
          "url": "ws://localhost:8766/ws"
      }
  ],
  "methods": [
      {
          "name": "file/list",
          "summary": "List directory contents",
          "description": "Returns the contents of a directory in the repository. Supports browsing the file tree.",
          "params": [
              {
                  "name": "path",
                  "description": "Relative path from repo root (empty for root directory)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              }
          ],
          "result": {
              "name": "FileListResult",
              "schema": {
                  "$ref": "#/components/schemas/FileListResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/FileNotFound"
              }
          ]
      },
      {
          "name": "session/list",
          "summary": "List sessions",
          "description": "Returns a list of available sessions from all configured AI agents.",
          "params": [
              {
                  "name": "agent_type",
                  "description": "Filter by agent type (optional)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "limit",
                  "description": "Maximum number of sessions to return",
                  "required": false,
                  "schema": {
                      "default": 50,
                      "type": "integer"
                  }
              }
          ],
          "result": {
              "name": "SessionListResult",
              "schema": {
                  "$ref": "#/components/schemas/SessionListResult"
              }
          }
      },
      {
          "name": "session/get",
          "summary": "Get session details",
          "description": "Returns detailed information about a specific session.",
          "params": [
              {
                  "name": "session_id",
                  "description": "Session ID to retrieve",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "agent_type",
                  "description": "Agent type (optional, searches all if not specified)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              }
          ],
          "result": {
              "name": "SessionInfo",
              "schema": {
                  "$ref": "#/components/schemas/SessionInfo"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/SessionNotFound"
              }
          ]
      },
      {
          "name": "session/messages",
          "summary": "Get session messages",
          "description": "Returns paginated messages for a specific session.",
          "params": [
              {
                  "name": "session_id",
                  "description": "Session ID to get messages from",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "agent_type",
                  "description": "Agent type (optional)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "limit",
                  "description": "Maximum messages to return (default 50, max 500)",
                  "required": false,
                  "schema": {
                      "default": 50,
                      "type": "integer"
                  }
              },
              {
                  "name": "offset",
                  "description": "Offset for pagination",
                  "required": false,
                  "schema": {
                      "default": 0,
                      "type": "integer"
                  }
              }
          ],
          "result": {
              "name": "SessionMessagesResult",
              "schema": {
                  "$ref": "#/components/schemas/SessionMessagesResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/SessionNotFound"
              }
          ]
      },
      {
          "name": "session/elements",
          "summary": "Get session UI elements",
          "description": "Returns pre-parsed UI elements for a session, ready for rendering in mobile apps.",
          "params": [
              {
                  "name": "session_id",
                  "description": "Session ID to get elements from",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "agent_type",
                  "description": "Agent type (optional)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "limit",
                  "description": "Maximum elements to return (default 50, max 100)",
                  "required": false,
                  "schema": {
                      "default": 50,
                      "type": "integer"
                  }
              },
              {
                  "name": "before",
                  "description": "Return elements before this ID (for pagination)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "after",
                  "description": "Return elements after this ID (for catch-up)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              }
          ],
          "result": {
              "name": "SessionElementsResult",
              "schema": {
                  "$ref": "#/components/schemas/SessionElementsResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/SessionNotFound"
              }
          ]
      },
      {
          "name": "agent/respond",
          "summary": "Respond to agent tool use request",
          "description": "Sends a response to an agent's tool use request (e.g., permission approval).",
          "params": [
              {
                  "name": "tool_use_id",
                  "description": "The tool use ID from the agent's request",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "response",
                  "description": "The response content",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "is_error",
                  "description": "Whether this is an error response",
                  "required": false,
                  "schema": {
                      "default": false,
                      "type": "boolean"
                  }
              }
          ],
          "result": {
              "name": "AgentRespondResult",
              "schema": {
                  "properties": {
                      "status": {
                          "type": "string"
                      },
                      "tool_use_id": {
                          "type": "string"
                      }
                  },
                  "type": "object"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/AgentNotRunning"
              }
          ]
      },
      {
          "name": "git/stage",
          "summary": "Stage files",
          "description": "Stages the specified files for commit.",
          "params": [
              {
                  "name": "paths",
                  "description": "Array of file paths to stage",
                  "required": true,
                  "schema": {
                      "items": {
                          "type": "string"
                      },
                      "type": "array"
                  }
              }
          ],
          "result": {
              "name": "OperationResult",
              "schema": {
                  "$ref": "#/components/schemas/OperationResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      },
      {
          "name": "git/push",
          "summary": "Push to remote",
          "description": "Pushes commits to the remote repository.",
          "params": [],
          "result": {
              "name": "OperationResult",
              "schema": {
                  "$ref": "#/components/schemas/OperationResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      },
      {
          "name": "git/checkout",
          "summary": "Checkout a branch",
          "description": "Checks out the specified branch.",
          "params": [
              {
                  "name": "branch",
                  "description": "Branch name to checkout",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              }
          ],
          "result": {
              "name": "CheckoutResult",
              "schema": {
                  "$ref": "#/components/schemas/CheckoutResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      },
      {
          "name": "session/watch",
          "summary": "Start watching a session",
          "description": "Starts watching a session for real-time updates. The client will receive notifications when new messages are added.",
          "params": [
              {
                  "name": "session_id",
                  "description": "Session ID to watch",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              }
          ],
          "result": {
              "name": "SessionWatchResult",
              "schema": {
                  "$ref": "#/components/schemas/SessionWatchResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/SessionNotFound"
              }
          ]
      },
      {
          "name": "initialized",
          "summary": "Confirm initialization",
          "description": "Confirm that the client has processed the initialize response. This is a notification (no response expected).",
          "params": []
      },
      {
          "name": "status/get",
          "summary": "Get server status",
          "description": "Returns the current status of the cdev server including agent state, connected clients, and configuration.",
          "params": [],
          "result": {
              "name": "StatusResult",
              "schema": {
                  "$ref": "#/components/schemas/StatusResult"
              }
          }
      },
      {
          "name": "agent/run",
          "summary": "Start an AI agent with a prompt",
          "description": "Starts the specified AI agent (Claude, Gemini, or Codex) with the given prompt. Can start a new session or continue an existing one.",
          "params": [
              {
                  "name": "prompt",
                  "description": "The prompt to send to the agent",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "mode",
                  "description": "Session mode: 'new' for new session, 'continue' to continue existing",
                  "required": false,
                  "schema": {
                      "default": "new",
                      "enum": [
                          "new",
                          "continue"
                      ],
                      "type": "string"
                  }
              },
              {
                  "name": "session_id",
                  "description": "Session ID to continue (required if mode is 'continue')",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              }
          ],
          "result": {
              "name": "AgentRunResult",
              "schema": {
                  "$ref": "#/components/schemas/AgentRunResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/AgentAlreadyRunning"
              },
              {
                  "$ref": "#/components/errors/AgentNotConfigured"
              }
          ]
      },
      {
          "name": "agent/stop",
          "summary": "Stop the running agent",
          "description": "Stops the currently running AI agent gracefully.",
          "params": [],
          "result": {
              "name": "AgentStopResult",
              "schema": {
                  "$ref": "#/components/schemas/AgentStopResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/AgentNotRunning"
              }
          ]
      },
      {
          "name": "git/status",
          "summary": "Get git repository status",
          "description": "Returns the current git status including staged, unstaged, and untracked files.",
          "params": [],
          "result": {
              "name": "GitStatusResult",
              "schema": {
                  "$ref": "#/components/schemas/GitStatusResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      },
      {
          "name": "git/unstage",
          "summary": "Unstage files",
          "description": "Unstages the specified files.",
          "params": [
              {
                  "name": "paths",
                  "description": "Array of file paths to unstage",
                  "required": true,
                  "schema": {
                      "items": {
                          "type": "string"
                      },
                      "type": "array"
                  }
              }
          ],
          "result": {
              "name": "OperationResult",
              "schema": {
                  "$ref": "#/components/schemas/OperationResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      },
      {
          "name": "git/discard",
          "summary": "Discard changes",
          "description": "Discards changes to the specified files.",
          "params": [
              {
                  "name": "paths",
                  "description": "Array of file paths to discard",
                  "required": true,
                  "schema": {
                      "items": {
                          "type": "string"
                      },
                      "type": "array"
                  }
              }
          ],
          "result": {
              "name": "OperationResult",
              "schema": {
                  "$ref": "#/components/schemas/OperationResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      },
      {
          "name": "git/pull",
          "summary": "Pull from remote",
          "description": "Pulls changes from the remote repository.",
          "params": [],
          "result": {
              "name": "OperationResult",
              "schema": {
                  "$ref": "#/components/schemas/OperationResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      },
      {
          "name": "file/get",
          "summary": "Get file content",
          "description": "Returns the content of a file from the repository.",
          "params": [
              {
                  "name": "path",
                  "description": "File path relative to repository root",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              }
          ],
          "result": {
              "name": "FileGetResult",
              "schema": {
                  "$ref": "#/components/schemas/FileGetResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/FileNotFound"
              }
          ]
      },
      {
          "name": "git/diff",
          "summary": "Get file diff",
          "description": "Returns the git diff for a specific file or all files.",
          "params": [
              {
                  "name": "path",
                  "description": "File path relative to repository root (optional, omit for all files)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              }
          ],
          "result": {
              "name": "GitDiffResult",
              "schema": {
                  "$ref": "#/components/schemas/GitDiffResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/FileNotFound"
              },
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      },
      {
          "name": "git/commit",
          "summary": "Create a commit",
          "description": "Creates a commit with the staged changes.",
          "params": [
              {
                  "name": "message",
                  "description": "Commit message",
                  "required": true,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "push",
                  "description": "Push after commit",
                  "required": false,
                  "schema": {
                      "default": false,
                      "type": "boolean"
                  }
              }
          ],
          "result": {
              "name": "CommitResult",
              "schema": {
                  "$ref": "#/components/schemas/CommitResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      },
      {
          "name": "session/delete",
          "summary": "Delete session(s)",
          "description": "Deletes a specific session or all sessions if no session_id is provided.",
          "params": [
              {
                  "name": "session_id",
                  "description": "Session ID to delete (optional, deletes all if not provided)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "agent_type",
                  "description": "Agent type (optional)",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              }
          ],
          "result": {
              "name": "SessionDeleteResult",
              "schema": {
                  "$ref": "#/components/schemas/SessionDeleteResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/SessionNotFound"
              }
          ]
      },
      {
          "name": "session/unwatch",
          "summary": "Stop watching session",
          "description": "Stops watching the current session.",
          "params": [],
          "result": {
              "name": "SessionUnwatchResult",
              "schema": {
                  "$ref": "#/components/schemas/SessionUnwatchResult"
              }
          }
      },
      {
          "name": "initialize",
          "summary": "Initialize connection",
          "description": "Initialize the connection and negotiate capabilities. Must be called first before using other methods.",
          "params": [
              {
                  "name": "protocolVersion",
                  "description": "Protocol version the client supports",
                  "required": false,
                  "schema": {
                      "type": "string"
                  }
              },
              {
                  "name": "clientInfo",
                  "description": "Client information",
                  "required": false,
                  "schema": {
                      "$ref": "#/components/schemas/ClientInfo"
                  }
              },
              {
                  "name": "capabilities",
                  "description": "Client capabilities",
                  "required": false,
                  "schema": {
                      "type": "object"
                  }
              }
          ],
          "result": {
              "name": "InitializeResult",
              "schema": {
                  "$ref": "#/components/schemas/InitializeResult"
              }
          }
      },
      {
          "name": "shutdown",
          "summary": "Shutdown server",
          "description": "Request the server to shut down gracefully.",
          "params": [],
          "result": {
              "name": "ShutdownResult",
              "schema": {
                  "properties": {
                      "status": {
                          "type": "string"
                      }
                  },
                  "type": "object"
              }
          }
      },
      {
          "name": "status/health",
          "summary": "Health check",
          "description": "Returns a simple health check response for monitoring.",
          "params": [],
          "result": {
              "name": "HealthResult",
              "schema": {
                  "$ref": "#/components/schemas/HealthResult"
              }
          }
      },
      {
          "name": "agent/status",
          "summary": "Get agent status",
          "description": "Returns the current status of the AI agent.",
          "params": [],
          "result": {
              "name": "AgentStatusResult",
              "schema": {
                  "$ref": "#/components/schemas/AgentStatusResult"
              }
          }
      },
      {
          "name": "git/branches",
          "summary": "List branches",
          "description": "Returns the list of git branches.",
          "params": [],
          "result": {
              "name": "BranchesResult",
              "schema": {
                  "$ref": "#/components/schemas/BranchesResult"
              }
          },
          "errors": [
              {
                  "$ref": "#/components/errors/GitError"
              }
          ]
      }
  ],
  "components": {
      "schemas": {
          "AgentRunResult": {
              "properties": {
                  "agent_type": {
                      "type": "string"
                  },
                  "session_id": {
                      "type": "string"
                  },
                  "status": {
                      "type": "string"
                  }
              },
              "type": "object"
          },
          "FileGetResult": {
              "properties": {
                  "content": {
                      "type": "string"
                  },
                  "path": {
                      "type": "string"
                  },
                  "size": {
                      "type": "integer"
                  },
                  "truncated": {
                      "type": "boolean"
                  }
              },
              "type": "object"
          },
          "GitStatusResult": {
              "properties": {
                  "branch": {
                      "type": "string"
                  },
                  "is_clean": {
                      "type": "boolean"
                  },
                  "staged": {
                      "items": {
                          "type": "string"
                      },
                      "type": "array"
                  },
                  "unstaged": {
                      "items": {
                          "type": "string"
                      },
                      "type": "array"
                  },
                  "untracked": {
                      "items": {
                          "type": "string"
                      },
                      "type": "array"
                  }
              },
              "type": "object"
          },
          "StatusResult": {
              "properties": {
                  "agent_session_id": {
                      "type": "string"
                  },
                  "agent_state": {
                      "type": "string"
                  },
                  "connected_clients": {
                      "type": "integer"
                  },
                  "repo_name": {
                      "type": "string"
                  },
                  "repo_path": {
                      "type": "string"
                  },
                  "session_id": {
                      "type": "string"
                  },
                  "uptime_seconds": {
                      "type": "integer"
                  },
                  "version": {
                      "type": "string"
                  }
              },
              "type": "object"
          }
      },
      "errors": {
          "AgentAlreadyRunning": {
              "code": -32001,
              "message": "An agent is already running"
          },
          "AgentError": {
              "code": -32003,
              "message": "Agent execution error"
          },
          "AgentNotConfigured": {
              "code": -32004,
              "message": "Agent type not configured"
          },
          "AgentNotRunning": {
              "code": -32002,
              "message": "No agent is currently running"
          },
          "FileNotFound": {
              "code": -32010,
              "message": "Requested file not found"
          },
          "GitError": {
              "code": -32011,
              "message": "Git operation failed"
          },
          "SessionNotFound": {
              "code": -32012,
              "message": "Session not found"
          }
      }
  }
}